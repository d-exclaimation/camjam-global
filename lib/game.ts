export const all = [
  {
    name: "bowl",
    icon: "ðŸ¥£",
    category: "Utensil",
    difficulty: 2,
  } as const,
  {
    name: "spoon",
    icon: "ðŸ¥„",
    category: "Utensil",
    difficulty: 2,
  } as const,
  {
    name: "knife",
    icon: "ðŸ”ª",
    category: "Utensil",
    difficulty: 3,
  } as const,
  {
    name: "cup",
    icon: "ðŸ¥¤",
    category: "Beverage",
    difficulty: 1,
  } as const,
  {
    name: "wine glass",
    icon: "ðŸ·",
    category: "Beverage",
    difficulty: 4,
  } as const,
  {
    name: "bottle",
    icon: "ðŸ¾",
    category: "Beverage",
    difficulty: 1,
  } as const,
  {
    name: "cake",
    icon: "ðŸŽ‚",
    category: "Food",
    difficulty: 3,
  } as const,
  {
    name: "donut",
    icon: "ðŸ©",
    category: "Food",
    difficulty: 2,
  } as const,
  {
    name: "pizza",
    icon: "ðŸ•",
    category: "Food",
    difficulty: 2,
  } as const,
  {
    name: "hot dog",
    icon: "ðŸŒ­",
    category: "Food",
    difficulty: 2,
  } as const,
  {
    name: "sandwich",
    icon: "ðŸ¥ª",
    category: "Food",
    difficulty: 2,
  } as const,
  {
    name: "carrot",
    icon: "ðŸ¥•",
    category: "Groceries",
    difficulty: 2,
  } as const,
  {
    name: "broccoli",
    icon: "ðŸ¥¦",
    category: "Groceries",
    difficulty: 2,
  } as const,
  {
    name: "orange",
    icon: "ðŸŠ",
    category: "Groceries",
    difficulty: 2,
  } as const,
  {
    name: "apple",
    icon: "ðŸŽ",
    category: "Groceries",
    difficulty: 2,
  } as const,
  {
    name: "banana",
    icon: "ðŸŒ",
    category: "Groceries",
    difficulty: 2,
  } as const,
  {
    name: "surfboard",
    icon: "ðŸ„â€â™‚ï¸",
    category: "Sport Gear",
    difficulty: 6,
  } as const,
  {
    name: "skateboard",
    icon: "ðŸ›¹",
    category: "Sport Gear",
    difficulty: 2,
  } as const,
  {
    name: "snowboard",
    icon: "ðŸ‚",
    category: "Sport Gear",
    difficulty: 6,
  } as const,
  {
    name: "skis",
    icon: "ðŸŽ¿",
    category: "Sport Gear",
    difficulty: 4,
  } as const,
  {
    name: "kite",
    icon: "ðŸª",
    category: "Sport Object",
    difficulty: 7,
  } as const,
  {
    name: "sports ball",
    icon: "âš½",
    category: "Sport Object",
    difficulty: 2,
  } as const,
  {
    name: "frisbee",
    icon: "ðŸ¥",
    category: "Sport Object",
    difficulty: 3,
  } as const,
  {
    name: "phone",
    icon: "ðŸ“±",
    category: "Electronics",
    difficulty: 1,
  } as const,
  {
    name: "keyboard",
    icon: "âŒ¨ï¸",
    category: "Electronics",
    difficulty: 1,
  } as const,
  {
    name: "mouse",
    icon: "ðŸ–±ï¸",
    category: "Electronics",
    difficulty: 1,
  } as const,
  {
    name: "laptop",
    icon: "ðŸ’»",
    category: "Electronics",
    difficulty: 1,
  } as const,
  {
    name: "tvmonitor",
    icon: "ðŸ“º",
    category: "Electronics",
    difficulty: 1,
  } as const,
  {
    name: "toothbrush",
    icon: "ðŸª¥",
    category: "Small Object",
    difficulty: 3,
  } as const,
  {
    name: "teddy bear",
    icon: "ðŸ§¸",
    category: "Small Object",
    difficulty: 5,
  } as const,
  {
    name: "scissors",
    icon: "âœ‚ï¸",
    category: "Small Object",
    difficulty: 2,
  } as const,
  {
    name: "clock",
    icon: "ðŸ•°ï¸",
    category: "Small Object",
    difficulty: 3,
  } as const,
  {
    name: "book",
    icon: "ðŸ“š",
    category: "Small Object",
    difficulty: 1,
  } as const,
  {
    name: "chair",
    icon: "ðŸª‘",
    category: "Public Object",
    difficulty: 2,
  } as const,
  {
    name: "traffic light",
    icon: "ðŸš¦",
    category: "Public Object",
    difficulty: 5,
  } as const,
  {
    name: "vase",
    icon: "ðŸº",
    category: "House Object",
    difficulty: 2,
  } as const,
  {
    name: "pottedplant",
    icon: "ðŸª´",
    category: "House Object",
    difficulty: 1,
  } as const,
  {
    name: "sofa",
    icon: "ðŸ›‹ï¸",
    category: "House Object",
    difficulty: 1,
  } as const,
  {
    name: "toilet",
    icon: "ðŸš½",
    category: "House Object",
    difficulty: 1,
  } as const,
  {
    name: "bed",
    icon: "ðŸ›ï¸",
    category: "House Object",
    difficulty: 1,
  } as const,
  {
    name: "suitcase",
    icon: "ðŸ’¼",
    category: "Clothing Object",
    difficulty: 2,
  } as const,
  {
    name: "umbrella",
    icon: "â˜‚ï¸",
    category: "Clothing Object",
    difficulty: 2,
  } as const,
  {
    name: "tie",
    icon: "ðŸ‘”",
    category: "Clothing Object",
    difficulty: 1,
  } as const,
  {
    name: "handbag",
    icon: "ðŸ‘œ",
    category: "Clothing Object",
    difficulty: 2,
  } as const,
  {
    name: "backpack",
    icon: "ðŸŽ’",
    category: "Clothing Object",
    difficulty: 1,
  } as const,
  {
    name: "boat",
    icon: "â›µ",
    category: "Public Transport",
    difficulty: 10,
  } as const,
  {
    name: "train",
    icon: "ðŸš‚",
    category: "Public Transport",
    difficulty: 10,
  } as const,
  {
    name: "bus",
    icon: "ðŸšŒ",
    category: "Public Transport",
    difficulty: 3,
  } as const,
  {
    name: "aeroplane",
    icon: "ðŸ›©ï¸",
    category: "Public Transport",
    difficulty: 10,
  } as const,
  {
    name: "truck",
    icon: "ðŸš›",
    category: "Transport",
    difficulty: 5,
  } as const,
  {
    name: "motorbike",
    icon: "ðŸ›µ",
    category: "Transport",
    difficulty: 6,
  } as const,
  {
    name: "car",
    icon: "ðŸš˜",
    category: "Transport",
    difficulty: 1,
  } as const,
  {
    name: "bicycle",
    icon: "ðŸš²",
    category: "Transport",
    difficulty: 1,
  } as const,
  {
    name: "giraffe",
    icon: "ðŸ¦’",
    category: "Wild Entity",
    difficulty: 10,
  } as const,
  {
    name: "zebra",
    icon: "ðŸ¦“",
    category: "Wild Entity",
    difficulty: 10,
  } as const,
  {
    name: "bear",
    icon: "ðŸ»",
    category: "Wild Entity",
    difficulty: 9,
  } as const,
  {
    name: "elephant",
    icon: "ðŸ˜",
    category: "Wild Entity",
    difficulty: 10,
  } as const,
  {
    name: "cow",
    icon: "ðŸ®",
    category: "Farm Entity",
    difficulty: 7,
  } as const,
  {
    name: "sheep",
    icon: "ðŸ‘",
    category: "Farm Entity",
    difficulty: 7,
  } as const,
  {
    name: "horse",
    icon: "ðŸ´",
    category: "Farm Entity",
    difficulty: 8,
  } as const,
  {
    name: "person",
    icon: "ðŸ‘¤",
    category: "House Entity",
    difficulty: 1,
  } as const,
  {
    name: "bird",
    icon: "ðŸ•Šï¸",
    category: "House Entity",
    difficulty: 2,
  } as const,
  {
    name: "cat",
    icon: "ðŸ±",
    category: "House Entity",
    difficulty: 1,
  } as const,
  {
    name: "dog",
    icon: "ðŸ¶",
    category: "House Entity",
    difficulty: 1,
  } as const,
];

export const categories = all.reduce((acc, curr) => {
  const existing = acc.get(curr.category) ?? [];
  existing.push(curr);
  acc.set(curr.category, existing);
  return acc;
}, new Map<string, typeof all>());

export const difficulties = [
  ["easiest", [4, 6]],
  ["easy", [6, 10]],
  ["medium", [11, 15]],
  ["hard", [16, 19]],
  ["hardest", [20, 26]],
] as const;

export function item(name: (typeof all)[number]["name"]): (typeof all)[number] {
  return all.find((item) => item.name === name)!;
}

export function randomItem() {
  const weights = all
    .map((item) => 11 - item.difficulty)
    .reduce((acc, x) => acc + x, 0);

  let cost = Math.floor(Math.random() * weights);

  for (const item of all) {
    cost -= 11 - item.difficulty;
    if (cost <= 0) {
      return item;
    }
  }

  return all[Math.floor(Math.random() * all.length)];
}

export function difficulty(items: typeof all) {
  const difficulty = items.reduce(
    (acc, curr) => acc + curr.difficulty,
    items.length
  );
  for (const [key, [min, max]] of difficulties) {
    if (difficulty >= min && difficulty <= max) {
      return key;
    }
  }
  return undefined;
}

export type Preset = {
  name: string;
  get: () => {
    items: typeof all;
    difficulty: (typeof difficulties)[number][0];
  };
  weight: number;
};

export const presets = [
  {
    name: "Go for groceries",
    get() {
      const groceries = [
        item("carrot"),
        item("apple"),
        item("banana"),
        item("orange"),
        item("broccoli"),
      ];
      const count = Math.floor(Math.random() * 3) + 2;
      const items = Array.from({ length: count }, () => false).map(
        () => groceries[Math.floor(Math.random() * groceries.length)]
      );
      const diff = difficulty(items);

      if (!diff) {
        return this.get();
      }

      return {
        items,
        difficulty: diff,
      };
    },
    weight: 3,
  },
  {
    name: "Get social",
    get() {
      const count = Math.floor(Math.random() * 3) + 2;
      const items = Array.from({ length: count }, () => false).map(() =>
        item("person")
      );
      return { items, difficulty: difficulty(items) ?? "hardest" };
    },
    weight: 5,
  },
  {
    name: "Selfie with",
    get() {
      const count = Math.floor(Math.random() * 3) + 1;
      const items = [
        item("person"),
        ...Array.from({ length: count }, () => false).map(() => randomItem()),
      ];
      const diff = difficulty(items);
      if (!diff) {
        return this.get();
      }
      return { items, difficulty: diff };
    },
    weight: 10,
  },
  {
    name: "Catch a plane",
    get() {
      const items = [item("aeroplane"), item("person")];
      return { items, difficulty: difficulty(items) ?? "hardest" };
    },
    weight: 1,
  },
  {
    name: "Random",
    get() {
      const count = Math.floor(Math.random() * 3) + 2;
      const items = Array.from({ length: count }, () => false).map(() =>
        randomItem()
      );
      const diff = difficulty(items);
      if (!diff) {
        return this.get();
      }
      return { items, difficulty: diff };
    },
    weight: 2,
  },
] satisfies Preset[];

export function preset() {
  const weights = presets
    .map(({ weight }) => weight)
    .reduce((acc, x) => acc + x, 0);

  let cost = Math.floor(Math.random() * weights);

  for (const preset of presets) {
    cost -= preset.weight;
    if (cost <= 0) {
      return preset;
    }
  }

  return presets[Math.floor(Math.random() * presets.length)];
}
